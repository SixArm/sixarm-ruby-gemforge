#!/bin/sh
set -euf

## Program Tracking ##

program_command="gemforge-update-doc"
program_version="5.0.0"
program_updated="2018-05-12"
program_license="GPL"
program_contact="Joel Parker Henderson (joel@joelparkerhenderson.com)"

## Help Function ##

help(){
cat << EOF
gemforge-update-doc

Update our gem's documentation via yard.

This is intended for a directory with these kinds of files:

  * `.yardoc`      # yard documentation configuration
  * `doc/`         # autogenerated rdoc files or yardoc files

Example:

    cd mygem
    gemforge-update-doc

Tracking:

  * Command: $program_command
  * Version: $program_version
  * Updated: $program_updated
  * License: $program_license
  * Contact: $program_contact
EOF
}

## Preflight

cmd "yard" || die "cmd yard"

## Main

# Delete existing
for f in .yardoc doc; do
  if [ -e "$f" ]; then
    git rm -fr "$f" || true
    rm -fr "$f" || true
  fi
done

# Create fresh
mkdir doc
yardoc lib/{*.rb,**/*.rb}
chmod +r -R doc/

# Commit
git add .yardoc
git add doc
git commit -m "Update doc" .yardoc doc
